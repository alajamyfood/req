<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"/>
<title>Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø¬Ù…ÙŠ</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
<meta property="og:title" content="Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø¬Ù…ÙŠ">
<meta property="og:description" content="Ø§Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø¬Ù…ÙŠ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø³Ù‡ÙˆÙ„Ø©">
<meta property="og:image" content="logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="logo.png">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#006d77">
<style>
:root{--turquoise-dark:#006d77;--turquoise-medium:#119da4;--turquoise-light:#83c5be;--turquoise-pale:#e0f7f4;--text-dark:#0d1f1f;--blur-bg:rgba(255,255,255,0.94);--border:#a0d4cf;}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Tajawal',sans-serif;background:linear-gradient(to bottom,var(--turquoise-dark),var(--turquoise-pale));background-attachment:fixed;color:var(--text-dark);padding:10px 8px;}
.container{background:var(--blur-bg);backdrop-filter:blur(12px);border-radius:18px;padding:24px 20px;max-width:720px;margin:20px auto;box-shadow:0 10px 35px rgba(0,109,119,.25);border:1px solid rgba(131,197,190,0.3);}
.header{text-align:center;margin-bottom:24px;}
.logo-img{max-width:320px;width:100%;margin:auto;display:block;}
h2{text-align:center;color:var(--turquoise-dark);margin-bottom:24px;font-size:1.9rem;}
.form-group{margin-bottom:20px;}
label{display:block;margin-bottom:8px;font-weight:600;font-size:1.05rem;}
input,select,textarea{width:100%;padding:14px;border:1px solid var(--border);border-radius:10px;font-size:1.05rem;}
table{width:100%;margin:12px 0 20px;}
th,td{padding:12px 10px;text-align:right;border-bottom:1px solid #eee;}
th{background:rgba(17,157,164,0.08);}
.remove-btn{background:#e74c3c;color:#fff;border:none;padding:10px;border-radius:8px;cursor:pointer;}
.add-btn{background:var(--turquoise-medium);color:#fff;border:none;padding:18px 14px;border-radius:10px;cursor:pointer;width:100%;margin-top:12px;font-size:1.25rem;font-weight:600;}
button[type="submit"]{width:100%;padding:16px;margin-top:24px;font-size:1.2rem;font-weight:700;background:linear-gradient(90deg,var(--turquoise-medium),var(--turquoise-light));color:#fff;border:none;border-radius:12px;cursor:pointer;}
.loading{pointer-events:none;opacity:0.85;}
.loading::after{content:'';display:inline-block;width:1.1em;height:1.1em;margin-left:0.6em;vertical-align:middle;border:3px solid white;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.note{text-align:center;font-size:.95rem;color:#444;margin-top:12px;}
.note a{color:var(--turquoise-dark);font-weight:700;text-decoration:none;}
.note a:hover{text-decoration:underline;}
#reviewModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;font-family:'Tajawal',sans-serif;}
#reviewModal .modal-content{background:white;padding:24px;border-radius:16px;max-width:90%;max-height:85vh;overflow-y:auto;box-shadow:0 10px 30px rgba(0,0,0,0.25);direction:rtl;text-align:right;}
#reviewModal h3{color:var(--turquoise-dark);margin-bottom:16px;font-size:1.4rem;text-align:center;}
#reviewModal pre{background:#f8f9fa;padding:16px;border-radius:10px;font-family:'Tajawal',monospace;white-space:pre-wrap;word-break:break-word;font-size:1.05rem;line-height:1.6;margin:16px 0;border:1px solid #e0e0e0;}
#reviewModal .buttons{display:flex;gap:16px;justify-content:center;margin-top:24px;flex-wrap:wrap;}
#reviewModal button{padding:12px 40px;border:none;border-radius:10px;font-size:1.1rem;cursor:pointer;min-width:220px;font-weight:600;}
#reviewModal .main-btn{background:linear-gradient(90deg,#119da4,#83c5be);color:white;}
#reviewModal .cancel-btn{background:#e0e0e0;color:#333;}
@media (max-width:580px){table{border-collapse:separate;border-spacing:0 18px;}thead{display:none;}tbody,tr,td{display:block;width:100%;}tr{margin-bottom:18px;border:1px solid #ddd;border-radius:14px;background:white;box-shadow:0 4px 14px rgba(0,0,0,0.08);padding:14px;}td{border:none;padding:6px 0;}.remove-btn{width:100%;margin-top:6px;}}
</style>
</head>
<body>

<div class="container">
  <div class="header"><img src="logo.png" class="logo-img" alt="Ø§Ù„Ø¹Ø¬Ù…ÙŠ" loading="lazy"></div>
  <h2>Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ Ù…Ù†ØªØ¬Ø§Øª</h2>
  <form id="orderForm">
    <div class="form-group">
      <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
      <input type="text" name="governorate" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ø³Ø·Ù†Ø¨ÙˆÙ„ - Ù‚ÙˆÙ†ÙŠØ§ - Ø£Ù†Ø·Ø§Ù„ÙŠØ§ - ØºØ§Ø²ÙŠ Ø¹Ù†ØªØ§Ø¨ Ø¥Ù„Ø®" required>
    </div>
    <div class="form-group">
      <label>Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ† *</label>
      <input type="text" name="customerName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" required>
    </div>
    <div class="form-group">
      <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
      <table>
        <thead><tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„ÙˆØ²Ù†</th><th></th></tr></thead>
        <tbody id="itemsBody"></tbody>
      </table>
      <button type="button" class="add-btn" onclick="addRow()">+ Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
    </div>
    <div class="form-group">
      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea name="notes" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ø§Ù„: Ù†ÙˆØ¹ Ø§Ù„ØªØºÙ„ÙŠÙ Ø£Ùˆ ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…ÙØ¶Ù„)"></textarea>
    </div>
    <button type="submit" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    <div class="note">ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªÙØ³Ø§Ø±ØŒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³: <a href="https://wa.me/905345758221" target="_blank" rel="noopener">00905345758221</a> ğŸ’¬</div>
  </form>

  <!-- Modal Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© -->
  <div id="reviewModal">
    <div class="modal-content">
      <h3>Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h3>
      <pre id="reviewText"></pre>
      <p style="text-align:center; font-weight:bold; margin:20px 0; color:#d32f2f;">
        Ù‡Ù„ Ø§Ù„Ø·Ù„Ø¨ ØµØ­ÙŠØ­ ÙˆÙƒØ§Ù…Ù„ØŸ
      </p>
      <div class="buttons">
        <button class="main-btn" id="confirmAndSend">Ù†Ø¹Ù… Ø£Ø±Ø³Ù„</button>
        <button class="cancel-btn" id="cancelReview">Ø±Ø§Ø¬Ø¹ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
      </div>
    </div>
  </div>
</div>

<datalist id="product-list">
<option value="001 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø© 325Øº"><option value="002 Ø¹Ø¬Ù…ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº"><option value="003 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 230Øº"><option value="004 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 450Øº"><option value="005 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 300Øº"><option value="006 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 225Øº"><option value="007 Ø¹Ø¬Ù…ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 225Øº"><option value="008 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 450Øº"><option value="009 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 225Øº"><option value="010 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø© 230Øº"><option value="011 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº"><option value="012 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…ØªØ¨Ù„ 230Øº"><option value="013 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ Ø­Ù…Øµ 230Øº"><option value="014 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº"><option value="015 Ø§Ù„Ø®Ø§Ù„ Ø­Ù…Øµ 230Øº"><option value="016 Ø§Ù„Ø®Ø§Ù„ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº"><option value="017 Ø§Ù„Ø®Ø§Ù„ Ù…ØªØ¨Ù„ 230Øº"><option value="018 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="019 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="020 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="021 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="022 Ø§Ù„Ø®Ø§Ù„ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="023 MNZ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="024 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ"><option value="025 Ø­Ù…Øµ Ø®Ø§Ù… Ø£Ø³Ø¨ØªÙŠÙƒ 20 ÙƒØº"><option value="026 2750Øº Ø¹Ø¬Ù…ÙŠ Ù„Ø¨Ù†Ø©"><option value="027 900Øº Ø¹Ø¬Ù…ÙŠ Ù„Ø¨Ù†Ø©"><option value="028 Ø£Ø¨Ùˆ Ø¹Ø¨Ø¯Ùˆ Ø­Ù…Øµ 300Øº">
</datalist>

<script>
const productWeights = {
  "001 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø© 325Øº": "325 ØºØ±Ø§Ù…",
  "002 Ø¹Ø¬Ù…ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº": "230 ØºØ±Ø§Ù…",
  "003 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 230Øº": "230 ØºØ±Ø§Ù…",
  "004 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 450Øº": "Ø¹Ù„Ø¨Ø© 450 ØºØ±Ø§Ù…",
  "005 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 300Øº": "Ø¹Ù„Ø¨Ø© 300 ØºØ±Ø§Ù…",
  "006 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ 225Øº": "Ø¹Ù„Ø¨Ø© 225 ØºØ±Ø§Ù…",
  "007 Ø¹Ø¬Ù…ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 225Øº": "Ø¹Ù„Ø¨Ø© 225 ØºØ±Ø§Ù…",
  "008 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 450Øº": "Ø¹Ù„Ø¨Ø© 450 ØºØ±Ø§Ù…",
  "009 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ 225Øº": "Ø¹Ù„Ø¨Ø© 225 ØºØ±Ø§Ù…",
  "010 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø© 230Øº": "230 ØºØ±Ø§Ù…",
  "011 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº": "230 ØºØ±Ø§Ù…",
  "012 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…ØªØ¨Ù„ 230Øº": "230 ØºØ±Ø§Ù…",
  "013 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ Ø­Ù…Øµ 230Øº": "230 ØºØ±Ø§Ù…",
  "014 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº": "230 ØºØ±Ø§Ù…",
  "015 Ø§Ù„Ø®Ø§Ù„ Ø­Ù…Øµ 230Øº": "230 ØºØ±Ø§Ù…",
  "016 Ø§Ù„Ø®Ø§Ù„ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… 230Øº": "230 ØºØ±Ø§Ù…",
  "017 Ø§Ù„Ø®Ø§Ù„ Ù…ØªØ¨Ù„ 230Øº": "230 ØºØ±Ø§Ù…",
  "018 Ø¹Ø¬Ù…ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "019 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ Ø­Ù…Øµ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "020 Ø²Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "021 Ø§Ù„Ø­Ù…ØµØ§Ù†ÙŠ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "022 Ø§Ù„Ø®Ø§Ù„ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "023 MNZ ÙƒØ±ÙŠÙ… Ø§Ù„Ø«ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "024 Ø¹Ø¬Ù…ÙŠ Ù…ØªØ¨Ù„ Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ": "ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…",
  "025 Ø­Ù…Øµ Ø®Ø§Ù… Ø£Ø³Ø¨ØªÙŠÙƒ 20 ÙƒØº": "20 ÙƒØº",
  "026 2750Øº Ø¹Ø¬Ù…ÙŠ Ù„Ø¨Ù†Ø©": "2750 ØºØ±Ø§Ù…",
  "027 900Øº Ø¹Ø¬Ù…ÙŠ Ù„Ø¨Ù†Ø©": "900 ØºØ±Ø§Ù…",
  "028 Ø£Ø¨Ùˆ Ø¹Ø¨Ø¯Ùˆ Ø­Ù…Øµ 300Øº": "Ø¹Ù„Ø¨Ø© 300 ØºØ±Ø§Ù…"
};

let rowCounter = 0;

function isDuplicate(v, c) {
  return [...document.querySelectorAll('[name^="product_"]')].filter(i => i !== c && i.value.trim() !== "").some(i => i.value.trim() === v);
}

function addRow() {
  const id = rowCounter++;
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input list="product-list" name="product_${id}" placeholder="Ø§Ø®ØªØ± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required></td>
    <td><input type="number" name="quantity_${id}" min="1" step="1" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required></td>
    <td><select name="weight_${id}">
      <option value="" disabled selected hidden>Ø§Ù„ÙˆØ²Ù†</option>
      <option value="325 ØºØ±Ø§Ù…">325 ØºØ±Ø§Ù…</option>
      <option value="230 ØºØ±Ø§Ù…">230 ØºØ±Ø§Ù…</option>
      <option value="450 ØºØ±Ø§Ù…">450 ØºØ±Ø§Ù…</option>
      <option value="300 ØºØ±Ø§Ù…">300 ØºØ±Ø§Ù…</option>
      <option value="225 ØºØ±Ø§Ù…">225 ØºØ±Ø§Ù…</option>
      <option value="ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…">ÙƒÙŠÙ„Ùˆ ØºØ±Ø§Ù…</option>
      <option value="2750 ØºØ±Ø§Ù…">2750 ØºØ±Ø§Ù…</option>
      <option value="900 ØºØ±Ø§Ù…">900 ØºØ±Ø§Ù…</option>
      <option value="20 ÙƒØº">20 ÙƒØº</option>
    </select></td>
    <td><button type="button" class="remove-btn" onclick="this.closest('tr').remove()">Ø­Ø°Ù</button></td>`;
  document.getElementById('itemsBody').appendChild(tr);

  const p = tr.querySelector(`[name="product_${id}"]`);
  const w = tr.querySelector(`[name="weight_${id}"]`);

  p.addEventListener('change', e => {
    const val = e.target.value.trim();
    if (isDuplicate(val, e.target)) {
      alert("Ù‡Ø°Ø§ Ø§Ù„ØµÙ†Ù Ù…Ø¶Ø§Ù Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
      e.target.value = "";
      w.value = "";
      return;
    }
    const expected = productWeights[val];
    if (expected) {
      if (!w.querySelector(`option[value="${expected}"]`)) {
        const opt = document.createElement('option');
        opt.value = expected;
        opt.textContent = expected;
        w.appendChild(opt);
      }
      w.value = expected;
    }
  });

  w.addEventListener('change', () => {
    const cur = p.value.trim();
    if (cur && productWeights[cur] && w.value !== productWeights[cur]) {
      alert("Ø§Ù„ÙˆØ²Ù† ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø®ØªØ§Ø±");
      w.value = productWeights[cur];
    }
  });
}

function getOrderSummaryForDisplay() {
  const rows = document.querySelectorAll('#itemsBody tr');
  let summary = `Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${rows.length}\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
  let i = 1;
  rows.forEach(row => {
    const prod = row.querySelector('[name^="product_"]')?.value.trim();
    const qty  = row.querySelector('[name^="quantity_"]')?.value;
    const wgt  = row.querySelector('[name^="weight_"]')?.value;
    if (prod) {
      summary += `${i}. ${prod}\n   Ø§Ù„ÙƒÙ…ÙŠØ©: ${qty}`;
      if (wgt) summary += ` - ${wgt}`;
      summary += '\n\n';
      i++;
    }
  });
  return summary.trim();
}

function buildWhatsAppMessage() {
  const gov   = document.querySelector('[name="governorate"]').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
  const name  = document.querySelector('[name="customerName"]').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
  const notes = document.querySelector('[name="notes"]').value.trim();

  let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø¬Ù…ÙŠ* ğŸ“¦\n\n`;
  msg += `ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${gov}\n`;
  msg += `ğŸ‘¤ Ø§Ù„Ø²Ø¨ÙˆÙ†: ${name}\n\n`;
  msg += `*Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:*\n`;

  const rows = document.querySelectorAll('#itemsBody tr');
  let idx = 1;
  rows.forEach(r => {
    const p = r.querySelector('[name^="product_"]')?.value.trim();
    const q = r.querySelector('[name^="quantity_"]')?.value;
    const w = r.querySelector('[name^="weight_"]')?.value;
    if (p) {
      msg += `${idx}. ${p}\n   Ø§Ù„ÙƒÙ…ÙŠØ©: ${q}`;
      if (w) msg += ` - ${w}`;
      msg += '\n\n';
      idx++;
    }
  });

  if (notes) msg += `*Ù…Ù„Ø§Ø­Ø¸Ø§Øª:*\n${notes}\n\n`;

  msg += `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù: ${idx-1}\n`;
  msg += `ÙŠØ¹Ø·ÙŠÙƒÙ… Ø§Ù„Ø¹Ø§ÙÙŠØ©`;

  return msg;
}

addRow();

document.getElementById('orderForm').addEventListener('submit', e => {
  e.preventDefault();
  if (!e.target.governorate.value.trim() || !e.target.customerName.value.trim()) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†");
    return;
  }
  if (document.querySelectorAll('#itemsBody tr').length === 0) {
    alert("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
    return;
  }

  document.getElementById('reviewText').textContent = getOrderSummaryForDisplay();
  document.getElementById('reviewModal').style.display = 'flex';
});

document.getElementById('confirmAndSend').onclick = function() {
  document.getElementById('reviewModal').style.display = 'none';

  // ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø£ÙˆÙ„Ø§Ù‹ (Ù…Ø±ØªØ¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ø¶ØºØ·Ø© â†’ Ø£Ù‚Ù„ Ø¹Ø±Ø¶Ø© Ù„Ù„Ø­Ø¬Ø¨)
  const msg = buildWhatsAppMessage();
  const phone = "905345758221";
  window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');

  // Ø«Ù… Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø´ÙŠØª
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.classList.add('loading');
  btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

  fetch("https://script.google.com/macros/s/AKfycbxrpX-EdIjiMZNNQwCBnWmMBzJaSqRBY5oSIYyFV0a95kMuAco-1JHaFa3ICNbMKzPI/exec", {
    method: "POST",
    mode: "no-cors",
    body: new FormData(document.getElementById('orderForm'))
  }).catch(() => {
    // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø®Ø·Ø£ Ù‚ÙˆÙŠ Ù„Ø£Ù† Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙØªØ­ Ø¨Ø§Ù„ÙØ¹Ù„
  }).finally(() => {
    btn.disabled = false;
    btn.classList.remove('loading');
    btn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";

    document.getElementById('orderForm').reset();
    document.getElementById('itemsBody').innerHTML = '';
    rowCounter = 0;
    addRow();
  });
};

document.getElementById('cancelReview').onclick = function() {
  document.getElementById('reviewModal').style.display = 'none';
};
</script>
</body>
</html>
